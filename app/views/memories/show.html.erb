<div style="width:100vw;">
  <div data-controller="edit-memory">
    <div class="container">
      <div class="card-memory">
        <div class="d-none" data-edit-memory-target="form">
          <%= simple_form_for @memory, data: { controller: 'flatpickr' } do |f| %>
            <%= f.input :photo, as: :file %>
            <%= f.input :date, as: :string, input_html: { data: { flatpickr_target: "memoryDate" } } %>
            <%= f.input :title %>
            <%= f.input :description, as: :text %>
            <%= f.input :key_memory, :input_html => { :checked => true } %>
            <div class="form-action">
              <%= f.button :submit, "Update", class: "btn btn-primary" %>
            </div>
          <% end %>
        </div>
        <div class="memory-infos" data-edit-memory-target="infos">
          <% if @memory.photo.attached? %>
            <i class="fa-solid fa-pen" data-action="click->edit-memory#displayForm" style="position: absolute; right: 20px; margin-top: 10px;"></i>
            <%= cl_image_tag @memory.photo.key, height: 300, width: 400, crop: :fill %>
          <% end %>
          <div class="card-memory-infos">
            <div>
              <h2><%= @memory.title %></h2>
              <p><%= @memory.description %></p>
            </div>
            <p class="card-memory-date"><%= @memory.date %></p>
          </div>
        </div>
      </div>
    </div>

    <div class="container" style="margin-top: 20px; margin-bottom: 10px; display: flex; justify-content: space-around;">
      <%= link_to memory_path(@memory), data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this memory?"} do %>
        <i class="fa-solid fa-trash" style="color: #184E77; font-size: 20px; text-decoration: none;"></i>
      <% end %>
      <% if @memory.photo.attached? == false %>
        <button data-action="click->edit-memory#displayForm" style="border: 0;"><i class="fa-solid fa-pen" style="color: #184E77; font-size: 20px;"></i></button>
      <% end %>
      <%# Tagging %>
      <% if @memory.tags.length == 0 %>
        <%= link_to new_memory_tag_path(@memory) do %>
          <i class="fa-regular fa-face-meh" style="color: gray; font-size: 20px;"></i>
        <% end %>
      <% else %>
        <% @memory.tags.each do |tag| %>
          <% if tag.emotional_tag.emotion == "bad"  %>
            <%= link_to tag_path(tag.id), data: {turbo_method: :delete} do %>
              <i class="fa-regular fa-face-frown" style="color: teal; font-size: 20px;"></i>
            <% end %>
          <% end %>
          <% if tag.emotional_tag.emotion == "okay"  %>
            <%= link_to tag_path(tag.id), data: {turbo_method: :delete} do %>
              <i class="fa-regular fa-face-meh" style="color: green; font-size: 20px;"></i>
            <% end %>
          <% end %>
          <% if tag.emotional_tag.emotion == "good"  %>
            <%= link_to tag_path(tag.id), data: {turbo_method: :delete} do %>
              <i class="fa-regular fa-face-smile-beam" style="color: green; font-size: 20px;"></i>
            <% end %>
          <% end %>
          <% if tag.emotional_tag.emotion == "trigger"  %>
            <%= link_to tag_path(tag.id), data: {turbo_method: :delete} do %>
              <i class="fa-solid fa-bolt-lightning" style="color: orange; font-size: 20px;"></i>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="container" style="padding-bottom: 20px;">
    <div class="card-memory">
      <h5 style="text-align: center; margin-top: 20px;">Notes</h5>
      <div class="form" style="margin-top: 0; padding-top: o;">
        <%= simple_form_for [@memory, @note] do |f| %>
          <%= f.input_field :content, :placeholder => "Add note", style: "width: 100%;" %>
          <%= f.submit "✔️", style: "border: 1px solid #5e548e; border-radius: 4px; background-color: transparent; margin-bottom: 15px; align-item: center; width: 100%; margin 0 auto;" %>
        <% end %>
      </div>
      <div class="container" data-controller="edit-note">
        <div class="container-edit-note">
          <% if @memory.notes != nil %>
            <% @memory.notes.each do |note| %>
              <div class="note-infos" style="padding: 20px;" data-edit-note-target="infos">
                <p style="font-size: 20px; color: black;"><%= note.content %></p>
                <p style="color: gray;"><%= note.created_at.strftime("Added on %m/%d/%Y at %I:%M%p") %>
                <i class="fa-solid fa-pen" style="font-size: 20px; margin-left: 15%;"data-action="click->edit-note#displayForm"></i>
                <%= link_to note_path(note.id), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} do %>
                  <i class="fa-solid fa-trash" style="font-size: 20px; color:gray; padding-left: 9%;"></i>
                <% end %></p>
              </div>
                <%= simple_form_for note, html: {class: "d-none", style:"width: 88vw;", data: {edit_note_target: "form", action: "submit->edit-movie#update"}} do |f| %>
                  <%= f.input :content %>
                  <%= f.submit "Update" %>
                <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<%# Background animation %>
<%= render "shared/bg_animation", animate: false, show_sun: true %>

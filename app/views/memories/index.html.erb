<div class="search-container">
  <%= form_with url: memories_path, method: :get, class: "d-flex" do %>
    <%= text_field_tag :query,
        params[:query],
        placeholder: "Find a memory"
    %>
    <%= button_tag do%>
      <i class="fa fa-search"></i>
    <% end %>
  <% end %>
</div>

<div class="filters d-flex justify-content-around">
 <%= form_with url: memories_path, method: :get do %>
  <select name="filter_option" onchange="this.form.submit()">
    <option value="">Filter by emotion</option>
    <option value="good">Good</option>
    <option value="okay">Okay</option>
    <option value="bad">Bad</i></option>
    <option value="trigger">Trigger</option>
  </select>
    <select name="filter_key" onchange="this.form.submit()">
    <option value="">Filter by key</option>
    <option value="true">Key Memories</option>
  </select>
  <% end %>
 </div>

  <section class="cd-timeline js-cd-timeline">
    <div class="container max-width-lg cd-timeline__container">
      <% @memories.each do |memory| %>
        <% if params[:filter_option].present? %>
          <% if memory.tags.length != 0 %>
            <% memory.tags.each do |tag| %>
              <% if tag.emotional_tag.emotion == params[:filter_option] %>
                <%= link_to memory_path(memory), style: "text-decoration: none;" do %>
                  <div class="cd-timeline__block">
                    <div class="cd-timeline__img cd-timeline__img--picture">
                      <% if memory.photo.attached? %>
                        <%= cl_image_tag memory.photo.key, height: 300, width: 400, crop: :fill %>
                      <% end %>
                    </div> <!-- cd-timeline__img -->

                    <div class="cd-timeline__content text-component" style="text-align: center;">
                      <h2><%= memory.title %></h2>
                      <p class="date"><%= memory.date.strftime("%B %d, %Y") %></p>
                      <p> <%= truncate(memory.description, :length => 60, :separator => ' ') %> </p>
                    </div> <!-- cd-timeline__content -->
                  </div> <!-- cd-timeline__block -->
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% elsif params[:filter_key].present? %>
          <% if memory.key_memory == true %>
            <%= link_to memory_path(memory), style: "text-decoration: none;" do %>
              <div class="cd-timeline__block">
                <div class="cd-timeline__img cd-timeline__img--picture">
                  <% if memory.photo.attached? %>
                    <%= cl_image_tag memory.photo.key, height: 300, width: 400, crop: :fill %>
                  <% end %>
                </div> <!-- cd-timeline__img -->

                <div class="cd-timeline__content text-component" style="text-align: center;">
                  <h2><%= memory.title %></h2>
                  <p class="date"><%= memory.date.strftime("%B %d, %Y") %></p>
                  <p> <%= truncate(memory.description, :length => 60, :separator => ' ') %> </p>
                </div> <!-- cd-timeline__content -->
              </div> <!-- cd-timeline__block -->
            <% end %>
          <% end %>
        <% else %>
          <%= link_to memory_path(memory), style: "text-decoration: none;" do %>
            <div class="cd-timeline__block">
              <div class="cd-timeline__img cd-timeline__img--picture">
                <% if memory.photo.attached? %>
                  <%= cl_image_tag memory.photo.key, height: 300, width: 400, crop: :fill %>
                <% end %>
              </div> <!-- cd-timeline__img -->

              <div class="cd-timeline__content text-component" style="text-align: center;">
                <h2><%= memory.title %></h2>
                <p class="date"><%= memory.date.strftime("%B %d, %Y") %></p>
                <p> <%= truncate(memory.description, :length => 60, :separator => ' ') %> </p>
                <div class="cd-timeline__tags" style="display: flex; justify-content: space-between; padding: 0 20px;">
                  <% if memory.tags.length == 0 %>
                    <i class="fa-regular fa-face-meh" style="color: transparent; font-size: 20px;"></i>
                  <% else %>
                    <% memory.tags.each do |tag| %>
                      <% if tag.emotional_tag.emotion == "bad"  %>
                          <i class="fa-regular fa-face-frown" style="color: teal; font-size: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i>
                      <% elsif tag.emotional_tag.emotion == "okay"  %>
                          <i class="fa-regular fa-face-meh" style="color: green; font-size: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i>
                      <% elsif tag.emotional_tag.emotion == "good"  %>
                          <i class="fa-regular fa-face-smile-beam" style="color: green; font-size: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i>
                      <% elsif tag.emotional_tag.emotion == "trigger"  %>
                          <i class="fa-solid fa-bolt-lightning" style="color: orange; font-size: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i>
                      <% end %>
                    <% end %>
                  <% end %>
                  <% if memory.key_memory %>
                    <i class="fa-solid fa-key" style="color: #FF7842; font-size: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i>
                  <% else %>
                    <i class="fa-solid fa-key" style="color: transparent; font-size: 20px;"></i>
                  <% end %>
                </div>
              </div> <!-- cd-timeline__content -->
            </div> <!-- cd-timeline__block -->
          <% end %>
        <% end %>
      <% end %>
    </div>
  </section> <!-- cd-timeline -->
</div>

<%# Background animation %>
<%= render "shared/bg_animation", animate: true, show_sun: true, show_arrowdown: false %>

<div style="width:100vw;">
  <div data-controller="edit-memory">
    <div class="container">
      <div class="card-memory">
        <div class="d-none" data-edit-memory-target="form" style="padding: 10px;">
          <h2 style="text-align: center">Edit this memory</h2>
          <hr>
          <%= simple_form_for @memory, data: { controller: 'photo-preview flatpickr' } do |f| %>
          <%= image_tag "", width: 300, class: "d-block mx-auto", data: { photo_preview_target: "preview" } %>
          <%= f.input :photo, as: :file, input_html: { class: 'd-none', data: { photo_preview_target: "input", action:"change->photo-preview#displayPreview" }}, label_html: { class: 'upload-photo'}, label: '📷 Upload a photo' %>
          <%= f.input :date, as: :string, input_html: { data: { flatpickr_target: "memoryDate" } } %>
          <%= f.input :title %>
          <%= f.input :description, as: :text %>
            <div class="form-action" style="text-align: center;">
            <%= f.button :submit, "Save", class: "btn btn-primary" %>
            </div>
          <% end %>
        </div>
        <div class="memory-infos" data-edit-memory-target="infos">
          <% if @memory.photo.attached? %>
            <%= cl_image_tag @memory.photo.key, height: 300, width: 400, crop: :fill %>
          <% end %>
          <div class="card-memory-infos">
            <h2><%= @memory.title %></h2>
            <p class="date"><%= @memory.date.strftime("%B %d, %Y") %></p>
            <p><%= @memory.description %></p>
          </div>
        </div>
      </div>


    <div class="container" style="margin-top: 20px; margin-bottom: 10px; display: flex; justify-content: space-around;" data-controller="key-button">
      <%= link_to memory_path(@memory), data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this memory?"} do %>
        <i class="fa-solid fa-trash" style="color: aliceblue; font-size: 20px; text-decoration: none; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i>
      <% end %>
      <button data-action="click->edit-memory#displayForm" style="border: 0; background-color: transparent; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"><i class="fa-solid fa-pen" style="color: aliceblue; font-size: 20px;"></i></button>
      <div data-controller="key-button">
        <%= simple_form_for @memory do |f| %>
          <div class="d-none">
          <input class="form-check-input is-valid boolean optional" value="<%= @memory.key_memory ? false : true %>" name="memory[key_memory]" id="memory_key_memory">
          </div>
          <div>
            <% if @memory.key_memory == true %>
              <button type="submit" style="background-color: transparent; border: 0;"><i class="fa-solid fa-key" style="color: #FF7842; font-size: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i></button>
            <% else %>
              <button type="submit" style="background-color: transparent; border: 0;"><i class="fa-solid fa-key" style="color:  aliceblue; font-size: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i></button>
            <% end %>
          </div>
        <% end %>
      </div>

      <%# Tagging %>
      <% if @memory.tags.length == 0 %>
        <button style="background-color: transparent; border: 0;" data-bs-toggle="modal" data-bs-target="#exampleModal">
          <i class="fa-regular fa-face-meh" style="color: aliceblue; font-size: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i>
        </button>
      <% else %>
        <% @memory.tags.each do |tag| %>
          <% if tag.emotional_tag.emotion == "bad"  %>
            <%= link_to tag_path(tag.id), data: {turbo_method: :delete} do %>
              <i class="fa-regular fa-face-frown" style="color: teal; font-size: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i>
            <% end %>
          <% end %>
          <% if tag.emotional_tag.emotion == "okay"  %>
            <%= link_to tag_path(tag.id), data: {turbo_method: :delete} do %>
              <i class="fa-regular fa-face-meh" style="color: green; font-size: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i>
            <% end %>
          <% end %>
          <% if tag.emotional_tag.emotion == "good"  %>
            <%= link_to tag_path(tag.id), data: {turbo_method: :delete} do %>
              <i class="fa-regular fa-face-smile-beam" style="color: green; font-size: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i>
            <% end %>
          <% end %>
          <% if tag.emotional_tag.emotion == "trigger"  %>
            <%= link_to tag_path(tag.id), data: {turbo_method: :delete} do %>
              <i class="fa-solid fa-bolt-lightning" style="color: orange; font-size: 20px; text-shadow: 0 1px 5px rgba(0,0,0,0.4);"></i>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>

  <%# modal %>
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" style="margin-top: 80%;">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <%= simple_form_for [@memory, @tag] do |f| %>
            <%= f.association :emotional_tag, collection: @emotional_tags.map {|tag| [tag["emotion"], tag["id"]]}, label: false, :include_blank => false %>
            <%= f.submit 'Add Tag', class: 'btn btn-primary', style: "width: 100%;" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <%# notes %>
  <div class="container" style="padding-bottom: 80px;">
    <div class="card-memory">
      <h5 style="text-align: center; margin-top: 20px;">Notes</h5>
      <div class="form" style="margin-top: 0; padding-top: o;">
        <%= simple_form_for [@memory, @note] do |f| %>
          <%= f.input_field :content, :placeholder => "Add note", style: "width: 100%;" %>
          <%= f.submit "✔️", style: "border: 1px solid #5e548e; border-radius: 4px; background-color: transparent; margin-bottom: 15px; align-item: center; width: 100%; margin 0 auto;" %>
        <% end %>
      </div>
      <div class="container" data-controller="edit-note">
        <div class="container-edit-note">
          <% if @memory.notes != nil %>
            <% @memory.notes.each do |note| %>
              <div class="note-infos" style="padding: 20px;" data-edit-note-target="infos">
                <p style="font-size: 20px; color: black;"><%= note.content %></p>
                <p style="color: gray; margin-left: 0;"><%= note.created_at.strftime("%b %d, %Y at %I:%M%p") %>
                <i class="fa-solid fa-pen" style="font-size: 15px; margin-left: 15%;"data-action="click->edit-note#displayForm"></i>
                <%= link_to note_path(note.id), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} do %>
                  <i class="fa-solid fa-trash" style="font-size: 15px; color:gray; padding-left: 9%;"></i>
                <% end %></p>
              </div>
                <%= simple_form_for note, html: {class: "d-none", style:"width: 88vw;", data: {edit_note_target: "form", action: "submit->edit-movie#update"}} do |f| %>
                  <%= f.input :content %>
                  <%= f.submit "Update" %>
                <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<%# Background animation %>
<%= render "shared/bg_animation", animate: false, show_sun: true, show_arrowdown: false %>

<div data-controller="edit-memory">
  <div class="container">
    <div class="card-memory">
      <div class="d-none" data-edit-memory-target="form">
        <%= simple_form_for @memory, data: { controller: 'flatpickr' } do |f| %>
          <%= f.input :photo, as: :file %>
          <%= f.input :date, as: :string, input_html: { data: { flatpickr_target: "memoryDate" } } %>
          <%= f.input :title %>
          <%= f.input :description, as: :text %>
          <div class="form-action">
            <%= f.button :submit, "Update", class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
      <div class="memory-infos" data-edit-memory-target="infos">
        <% if @memory.photo.attached? %>
          <i class="fa-solid fa-pen" data-action="click->edit-memory#displayForm" style="position: absolute; right: 20px; margin-top: 10px;"></i>
          <%= cl_image_tag @memory.photo.key, height: 300, width: 400, crop: :fill %>
        <% end %>
        <div class="card-memory-infos">
          <div>
            <h2><%= @memory.title %></h2>
            <p><%= @memory.description %></p>
          </div>
          <p class="card-memory-date"><%= @memory.date %></p>
        </div>
      </div>
    </div>
  </div>

  <div class="container" style="margin-top: 10px; margin-bottom: 10px; ">
    <%= link_to "Delete",
      memory_path(@memory),
      data: {turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this memory?"},
      class: "btn btn-primary"
    %>
    <button class="btn btn-primary" data-action="click->edit-memory#displayForm">Edit</button>
  </div>
</div>

<div class="container">
  <div class="container-notes">
    <h5>Notes</h5>
    <div class="form">
      <div class="container pt-3">
        <%= simple_form_for [@memory, @note] do |f| %>
          <%= f.input_field :content, :placeholder => "Add note" %>
          <%= f.submit "SUBMIT", class: "btn btn-primary" %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="container" data-controller="edit-note">
  <div class="container-edit-note">
    <% if @memory.notes != nil %>
      <% @memory.notes.each do |note| %>
        <div class="note-infos" data-edit-note-target="infos">
          <p><%= note.content %></p>
          <p><%= note.created_at.strftime("Added on %m/%d/%Y at %I:%M%p") %>
          <i class="fa-solid fa-pen" data-action="click->edit-note#displayForm"></i>
          <%= link_to note_path(note.id), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} do %>
            <i class="fa-solid fa-trash"></i>
          <% end %></p>
        </div>
          <%= simple_form_for note, html: {class: "d-none", data: {edit_note_target: "form", action: "submit->edit-movie#update"}} do |f| %>
            <%= f.input :content %>
            <%= f.submit "Update" %>
          <% end %>
      <% end %>
    <% end %>
  </div>
</div>
